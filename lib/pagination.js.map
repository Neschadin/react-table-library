{"version":3,"file":"pagination.js","sources":["../src/pagination/usePagination.js"],"sourcesContent":["import * as React from 'react';\n\nimport { useReducerWithMiddleware } from '@table-library/react-table-library/common/util/useReducerWithMiddleware';\nimport { useSyncControlledState } from '@table-library/react-table-library/common/util//useSyncControlledState';\nimport { useSyncRefState } from '@table-library/react-table-library/common/util/useSyncRefState';\n\nconst SET = 'SET';\n\nconst set = (state, action) => ({ ...state, ...action.payload });\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case SET: {\n      return set(state, action);\n    }\n    default:\n      throw new Error();\n  }\n};\n\nconst DEFAULT_STATE = {\n  page: 0,\n  size: 10,\n};\n\nconst DEFAULT_OPTIONS = {\n  isServer: false,\n};\n\nconst usePagination = (data, primary = {}, options = {}, context) => {\n  const primaryNullFallback = primary || {};\n  const controlledState = {\n    ...DEFAULT_STATE,\n    ...primaryNullFallback.state,\n  };\n  const onChange = primaryNullFallback.onChange || (() => {});\n\n  const [state, dispatchWithMiddleware] = useReducerWithMiddleware(\n    reducer,\n    controlledState,\n    [],\n    [onChange],\n    context\n  );\n\n  const onSetPage = React.useCallback(\n    (value) =>\n      dispatchWithMiddleware({\n        type: SET,\n        payload: { page: value },\n      }),\n    [dispatchWithMiddleware]\n  );\n\n  const onSetSize = React.useCallback(\n    (value) =>\n      dispatchWithMiddleware({\n        type: SET,\n        payload: { size: value, page: 0 },\n      }),\n    [dispatchWithMiddleware]\n  );\n\n  useSyncControlledState(controlledState, state, () =>\n    dispatchWithMiddleware({\n      type: SET,\n      payload: controlledState,\n    })\n  );\n\n  const getTotalPages = React.useCallback(\n    (nodes) => Math.ceil(nodes.length / state.size),\n    [state.size]\n  );\n\n  const getPages = React.useCallback(\n    (nodes) =>\n      nodes.reduce((acc, item, index) => {\n        const sizeIndex = Math.floor(index / state.size);\n\n        if (!acc[sizeIndex]) {\n          acc[sizeIndex] = [];\n        }\n\n        acc[sizeIndex].push(item);\n\n        return acc;\n      }, []),\n    [state.size]\n  );\n\n  const getPageBoundaries = React.useCallback(\n    (nodes) => {\n      const start = state.page * state.size + 1;\n      const end = state.page * state.size + state.size;\n\n      return {\n        start,\n        end: end > nodes.length ? nodes.length : end,\n      };\n    },\n    [state.page, state.size]\n  );\n\n  const fns = React.useMemo(\n    () => ({\n      onSetPage,\n      onSetSize,\n    }),\n    [onSetPage, onSetSize]\n  );\n\n  useSyncRefState('pagination', context, state);\n\n  const mergedOptions = {\n    ...DEFAULT_OPTIONS,\n    ...options,\n  };\n\n  return {\n    state: { ...state, getTotalPages, getPages, getPageBoundaries },\n    fns,\n    _options: mergedOptions,\n  };\n};\n\nexport { usePagination };\n"],"names":["SET","reducer","state","action","type","payload","set","Error","DEFAULT_STATE","page","size","DEFAULT_OPTIONS","isServer","usePagination","data","primary","options","context","primaryNullFallback","controlledState","onChange","useReducerWithMiddleware","dispatchWithMiddleware","onSetPage","React","useCallback","value","onSetSize","useSyncControlledState","getTotalPages","nodes","Math","ceil","length","getPages","reduce","acc","item","index","sizeIndex","floor","push","getPageBoundaries","start","end","fns","useMemo","useSyncRefState","mergedOptions","_options"],"mappings":"6uBAMA,IAAMA,EAAM,MAINC,EAAU,SAACC,EAAOC,UACdA,EAAOC,WACRJ,SAJG,SAACE,EAAOC,iBAAiBD,GAAUC,EAAOE,SAKzCC,CAAIJ,EAAOC,iBAGZ,IAAII,QAIVC,EAAgB,CACpBC,KAAM,EACNC,KAAM,IAGFC,EAAkB,CACtBC,UAAU,GAGNC,EAAgB,SAACC,OAAMC,yDAAU,GAAIC,yDAAU,GAAIC,yCACjDC,EAAsBH,GAAW,GACjCI,SACDX,GACAU,EAAoBhB,OAEnBkB,EAAWF,EAAoBE,UAAa,eAEVC,EACtCpB,EACAkB,EACA,GACA,CAACC,GACDH,YALKf,OAAOoB,OAQRC,EAAYC,EAAMC,aACtB,SAACC,UACCJ,EAAuB,CACrBlB,KAAMJ,EACNK,QAAS,CAAEI,KAAMiB,OAErB,CAACJ,IAGGK,EAAYH,EAAMC,aACtB,SAACC,UACCJ,EAAuB,CACrBlB,KAAMJ,EACNK,QAAS,CAAEK,KAAMgB,EAAOjB,KAAM,OAElC,CAACa,IAGHM,EAAuBT,EAAiBjB,GAAO,kBAC7CoB,EAAuB,CACrBlB,KAAMJ,EACNK,QAASc,WAIPU,EAAgBL,EAAMC,aAC1B,SAACK,UAAUC,KAAKC,KAAKF,EAAMG,OAAS/B,EAAMQ,QAC1C,CAACR,EAAMQ,OAGHwB,EAAWV,EAAMC,aACrB,SAACK,UACCA,EAAMK,QAAO,SAACC,EAAKC,EAAMC,OACjBC,EAAYR,KAAKS,MAAMF,EAAQpC,EAAMQ,aAEtC0B,EAAIG,KACPH,EAAIG,GAAa,IAGnBH,EAAIG,GAAWE,KAAKJ,GAEbD,IACN,MACL,CAAClC,EAAMQ,OAGHgC,EAAoBlB,EAAMC,aAC9B,SAACK,OACOa,EAAQzC,EAAMO,KAAOP,EAAMQ,KAAO,EAClCkC,EAAM1C,EAAMO,KAAOP,EAAMQ,KAAOR,EAAMQ,WAErC,CACLiC,MAAAA,EACAC,IAAKA,EAAMd,EAAMG,OAASH,EAAMG,OAASW,KAG7C,CAAC1C,EAAMO,KAAMP,EAAMQ,OAGfmC,EAAMrB,EAAMsB,SAChB,iBAAO,CACLvB,UAAAA,EACAI,UAAAA,KAEF,CAACJ,EAAWI,IAGdoB,EAAgB,aAAc9B,EAASf,OAEjC8C,SACDrC,GACAK,SAGE,CACLd,aAAYA,OAAO2B,cAAAA,EAAeK,SAAAA,EAAUQ,kBAAAA,IAC5CG,IAAAA,EACAI,SAAUD"}